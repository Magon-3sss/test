{% extends 'components/base.html' %}
{% load static %}

    {% block styles %}

    {% endblock %}
    
        {% block content %}
        
						<!-- PAGE-HEADER -->
						<div class="page-header">
							<div>
								<h1 class="page-title">Détection des Anomalies</h1>
							</div>
							<div class="ms-auto pageheader-btn">
								<ol class="breadcrumb">
									<li class="breadcrumb-item">Santé</li>
									<li class="breadcrumb-item"><a href="javascript:void(0);">Détection Manuelle</a></li>
									{% comment %} <li class="breadcrumb-item active" aria-current="page">Products</li> {% endcomment %}
								</ol>
							</div>
						</div>
						<!-- PAGE-HEADER END -->

						<!-- ROW-1 OPEN -->
						<div class="row row-cards">
							<div class="row">
								<div class="col-md-12">
									<div class="card">
										<div class="card-body project-type-container projects p-4">
											<h4 class="m-0" id="typeTitle">Analyse des images </h4>
											<div class="d-sm-flex align-items-center">
												<div class="btn-list mx-4">
														<a class="btn btn-outline-primary btn-block py-2" id="btnCompose" data-bs-target="#Vertically" data-bs-toggle="modal" href="#"><i class="fa fa-plus me-2"></i>
															Upload Files 
															<svg fill="#000000" height="24px" width="24px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 212.366 212.366" xml:space="preserve">
																<g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> 
																<path d="M68.469,54.652h75.878c0.007,0.001,0.015,0.001,0.02,0c4.143,0,7.5-3.357,7.5-7.5c0-0.203-0.008-0.404-0.023-0.604 c-0.325-24.777-20.582-44.834-45.436-44.834c-25.055,0-45.438,20.383-45.438,45.438C60.969,51.294,64.327,54.652,68.469,54.652z M106.407,16.714c14.196,0,26.155,9.769,29.505,22.937H76.904C80.253,26.484,92.211,16.714,106.407,16.714z"></path> 
																<path d="M204.866,113.019h-35.441V75.398l28.313-28.312c2.93-2.93,2.93-7.678,0.001-10.606c-2.929-2.929-7.677-2.93-10.607-0.001 L158.818,64.79H53.983L25.671,36.479c-2.929-2.93-7.678-2.929-10.607-0.001c-2.929,2.93-2.929,7.678,0,10.607l28.311,28.311v37.623 H7.5c-4.142,0-7.5,3.357-7.5,7.5c0,4.143,3.358,7.5,7.5,7.5h35.881c0.041,12.754,3.894,24.624,10.471,34.539l-35.291,35.29 c-2.929,2.93-2.929,7.678,0,10.607c1.464,1.464,3.384,2.196,5.303,2.196c1.919,0,3.839-0.732,5.303-2.196l34.433-34.433 c11.248,10.428,26.289,16.818,42.801,16.818c16.4,0,31.354-6.302,42.577-16.605l34.217,34.219c1.465,1.465,3.384,2.197,5.304,2.197 c1.919,0,3.839-0.732,5.303-2.196c2.93-2.929,2.93-7.678,0.001-10.607l-35.024-35.025c6.684-9.968,10.601-21.938,10.642-34.805 h35.446c4.143,0,7.5-3.357,7.5-7.5C212.366,116.376,209.009,113.019,204.866,113.019z M58.376,127.816V79.79h40.525v95.461 C75.97,171.64,58.376,151.746,58.376,127.816z M113.901,175.251V79.79h40.523v48.025 C154.425,151.746,136.831,171.64,113.901,175.251z"></path> 
															</g> </g></svg>
														</a>
												</div>
											</div>
											<div class="modal">
												<div class="modal-dialog modal-lg" role="document">
													<div class="modal-content">
														<div class="modal-header pd-20">
															<h6 class="modal-title">Create New Document</h6><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" ><span aria-hidden="true">&times;</span></button>
														</div>
														<div class="modal-body pd-0">
															<div class="ql-wrapper ql-wrapper-modal ht-250">
																<div class="flex-1" id="quillEditorModal">
																	<p><strong>Quill</strong> is a free, open source <a href="https://github.com/quilljs/quill/">WYSIWYG editor</a> built for the modern web. With its <a href="https://quilljs.com/docs/modules/">modular architecture</a> and expressive API, it is completely customizable to fit any need.</p><br>
																	<p>The icons use here as a replacement to default svg icons are from <a href="https://icons8.com/line-awesome">Line Awesome Icons</a>.</p>
																</div>
															</div>
														</div>
														<div class="modal-footer pd-20">
															<button class="btn btn-primary" >Save changes</button> <button class="btn btn-light" data-bs-dismiss="modal" aria-label="Close">Cancel</button>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-xl-3 col-lg-12">
								<div class="row">
									<div class="col-md-12 col-lg-12">

										<div class="card">
											<div class="card-header border-bottom">
												<div class="card-title"> Categories &amp; Fliters</div>
											</div>
											<div class="card-body">
												<div class="form-group mt-3">
													<label class="form-label">Category</label>
													<select name="beast" id="select-beast" class="form-control form-select select2">
														<option value="0">--Select--</option>
														<option value="1">Dress</option>
														<option value="2">Bags &amp; Purses</option>
														<option value="3">Coat &amp; Jacket</option>
														<option value="4">Beauty</option>
														<option value="5">Jeans</option>
														<option value="5">Jewellery</option>
														<option value="5">Electronics</option>
														<option value="5">Sports</option>
														<option value="5">Technology</option>
														<option value="5">Watches</option>
														<option value="5">Accessories</option>
													</select>
												</div>
												<div class="form-group">
													<label class="form-label">Brand</label>
													<select name="beast" id="select-beast1" class="form-control form-select select2">
														<option value="0">--Select--</option>
														<option value="1">White</option>
														<option value="2">Black</option>
														<option value="3">Red</option>
														<option value="4">Green</option>
														<option value="5">Blue</option>
														<option value="6">Yellow</option>
													</select>
												</div>
												<div class="form-group">
													<label class="form-label">Type</label>
													<select name="beast" id="select-beast2" class="form-control form-select select2">
														<option value="0">--Select--</option>
														<option value="1">Extra Small</option>
														<option value="2">Small</option>
														<option value="3">Medium</option>
														<option value="4">Large</option>
														<option value="5">Extra Large</option>
													</select>
												</div>
												<a class="btn btn-primary my-1" href="#">Apply Filter</a>
												<a class="btn btn-info my-1" href="#">Search Now</a>
											</div>
										</div>

									</div>
								</div>
							</div><!-- COL-END -->

							<div class="col-xl-9 col-lg-12">

								<div class="card">
									<div class="card-body">
										<div class="row">
											<div class="col-md-4">
												<div class="form-group mb-0 my-1">
													<select name="beast" id="select-beast4" class="form-control form-select select2">
														<option value="0">
															-- Sort By --
														</option>
														<option value="1">Featured</option>
														<option value="2">Price: Hight to Low ↓</option>
														<option value="3">Price: Low to High ↑</option>
														<option value="4">Relese Date</option>
														<option value="5">Rating</option>
													</select>
												</div>
											</div>

											<div class="col-md-4 text-center d-none d-xl-block">
												<div class="btn-group my-1">
													<button class="btn btn-primary four-col" id="viewBtn" name="view" onclick="fourCol(event)">IV</button>
													<button class="btn btn-primary three-col" id="viewBtn1" name="view" onclick="threeCol(event)">III</button>
													<button class="btn btn-primary two-col" id="viewBtn2" name="view" onclick="twoCol(event)">II</button>
												</div>
											</div>
											<div class="col-xl">
												<div class="input-group my-1">
													<input type="text" class="form-control" placeholder="Search ...">
													<button id="searchButton" class="input-group-text btn btn-primary text-white">Search</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								
								
								<div class="row products-main">
									{% for result_image in page_obj %}
									<div class="col-12 col-md-6 col-sm-6 col-lg-6 col-xl-3 product-each">
										<div class="card item-card">
											<div class="product-grid6 card-body">
												<div class="product-image6">
													<a href="analyse-details" class="img-container">
														{% if result_image.result_image %}
															<img class="img-fluid" src="{{ result_image.result_image.url }}" alt="result image">
														{% else %}
															<img class="img-fluid" src="{% static 'assets/images/pngs/visa.png' %}" alt="placeholder image">
														{% endif %}
													</a>
													{% comment %} <a href="analyse-details" class="img-container">
														<img class="img-fluid" src="{{ result_image.result_image.url }}" alt="img">
													</a> {% endcomment %}
													<div class="icon-container">
														<ul class="icons">
															<li>
																<a href="analyse-details" data-tip="Quick View">
																	<svg xmlns="http://www.w3.org/2000/svg" class="w-inner-icn" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="M12,8c-2.2091675,0-4,1.7908325-4,4s1.7908325,4,4,4c2.208252-0.0021973,3.9978027-1.791748,4-4C16,9.7908325,14.2091675,8,12,8z M12,15c-1.6568604,0-3-1.3431396-3-3s1.3431396-3,3-3c1.6561279,0.0018311,2.9981689,1.3438721,3,3C15,13.6568604,13.6568604,15,12,15z M21.960022,11.8046875C19.9189453,6.9902344,16.1025391,4,12,4s-7.9189453,2.9902344-9.960022,7.8046875c-0.0537109,0.1246948-0.0537109,0.2659302,0,0.390625C4.0810547,17.0097656,7.8974609,20,12,20s7.9190063-2.9902344,9.960022-7.8046875C22.0137329,12.0706177,22.0137329,11.9293823,21.960022,11.8046875z M12,19c-3.6396484,0-7.0556641-2.6767578-8.9550781-7C4.9443359,7.6767578,8.3603516,5,12,5s7.0556641,2.6767578,8.9550781,7C19.0556641,16.3232422,15.6396484,19,12,19z"></path></svg>
																</a>
															</li>
															<li>
																<a href="wishlist" data-tip="Add to Wishlist">
																	<svg xmlns="http://www.w3.org/2000/svg" class="w-inner-icn" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="M20.2246094,4.5693359C17.9908447,2.3260498,14.4058838,2.1826172,12,4.2402344C9.5941162,2.1826172,6.0091553,2.3260498,3.7753906,4.5693359c-2.3632812,2.3798218-2.3632812,6.2207642,0,8.6005859l7.8701172,7.8955078c0.09375,0.0944824,0.2213745,0.147583,0.3544922,0.1474609c0.1331177,0.0001221,0.2607422-0.0529785,0.3544922-0.1474609l7.8701172-7.8955078C22.5878906,10.7901001,22.5878906,6.9491577,20.2246094,4.5693359z M19.515625,12.4649048L12,20.0048828l-7.515625-7.5400391c-1.9755859-1.9897461-1.9755859-5.2007446,0-7.1904297C5.430603,4.319458,6.7201538,3.7837524,8.0644531,3.7871094c1.3446655-0.00354,2.6345825,0.5322266,3.5810547,1.4873657c0.1983643,0.1894531,0.5106201,0.1894531,0.7089844,0c0.0047607-0.0047607,0.0094604-0.0095215,0.0142212-0.0142822c1.9775391-1.9696045,5.1773071-1.9632568,7.1469116,0.0142822C21.4912109,7.2641602,21.4912109,10.4751587,19.515625,12.4649048z"></path></svg>
																</a>
															</li>
															<li>
																<a href="#" class="delete-item" data-id="{{ result_image.id }}" data-tip="Delete">
																	<svg viewBox="0 0 1024 1024" fill="#000000" class="w-inner-icn" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M32 241.6c-11.2 0-20-8.8-20-20s8.8-20 20-20l940 1.6c11.2 0 20 8.8 20 20s-8.8 20-20 20L32 241.6zM186.4 282.4c0-11.2 8.8-20 20-20s20 8.8 20 20v688.8l585.6-6.4V289.6c0-11.2 8.8-20 20-20s20 8.8 20 20v716.8l-666.4 7.2V282.4z" fill=""></path><path d="M682.4 867.2c-11.2 0-20-8.8-20-20V372c0-11.2 8.8-20 20-20s20 8.8 20 20v475.2c0.8 11.2-8.8 20-20 20zM367.2 867.2c-11.2 0-20-8.8-20-20V372c0-11.2 8.8-20 20-20s20 8.8 20 20v475.2c0.8 11.2-8.8 20-20 20zM524.8 867.2c-11.2 0-20-8.8-20-20V372c0-11.2 8.8-20 20-20s20 8.8 20 20v475.2c0.8 11.2-8.8 20-20 20zM655.2 213.6v-48.8c0-17.6-14.4-32-32-32H418.4c-18.4 0-32 14.4-32 32.8V208h-40v-42.4c0-40 32.8-72.8 72.8-72.8H624c40 0 72.8 32.8 72.8 72.8v48.8h-41.6z" fill=""></path></g></svg>
																</a>
															</li>
															<li>
																<a href="#" data-tip="notify me">
																	<svg xmlns="http://www.w3.org/2000/svg" class="w-inner-icn" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="M18,14.1V10c0-3.1-2.4-5.7-5.5-6V2.5C12.5,2.2,12.3,2,12,2s-0.5,0.2-0.5,0.5V4C8.4,4.3,6,6.9,6,10v4.1c-1.1,0.2-2,1.2-2,2.4v2C4,18.8,4.2,19,4.5,19h3.7c0.5,1.7,2,3,3.8,3c1.8,0,3.4-1.3,3.8-3h3.7c0.3,0,0.5-0.2,0.5-0.5v-2C20,15.3,19.1,14.3,18,14.1z M7,10c0-2.8,2.2-5,5-5s5,2.2,5,5v4H7V10z M13,20.8c-1.6,0.5-3.3-0.3-3.8-1.8h5.6C14.5,19.9,13.8,20.5,13,20.8z M19,18H5v-1.5C5,15.7,5.7,15,6.5,15h11c0.8,0,1.5,0.7,1.5,1.5V18z"/></svg>
																</a>
															</li>
														</ul>
													</div>
												</div>
												<div class="product-content w-100 p-3">
													<div class="mb-2">
														<h4 class="mb-1 text-normal"><a href="#">Multi Colour Flower Pot Set</a> </h4>
														<p class="mb-0 text-muted text-start">brand name</p>
													</div>
													<p class="mb-2 text-warning">
														<span>
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star"></i>
															<i class="fa fa-star-half-o"></i>
														</span>
														<span class="ms-2">(4.5)</span>
													</p>
													<div class="d-flex align-items-center justify-content-between">
														<p class="mb-0">
															<span class="text-22">$200</span>
															<span class="text-decoration-line-through text-muted ms-1">$320</span>
														</p>
														<p class="mb-0 text-secondary">item unavailable</p>
													</div>
												</div>
											</div>
										</div>
									</div>
								{% endfor %}
								</div>

								<div class="mb-5">
									<div class="float-end">
										<ul class="pagination ">
											{% if page_obj.has_previous %}
											<li class="page-item page-prev">
												<a class="page-link" href="?page={{ page_obj.previous_page_number }}" tabindex="-1">Prev</a>
											</li>
											{% else %}
											<li class="page-item page-prev disabled">
												<a class="page-link" href="#" tabindex="-1">Prev</a>
											</li>
											{% endif %}
								
											{% for page_num in page_obj.paginator.page_range %}
												{% if page_obj.number == page_num %}
													<li class="page-item active"><a class="page-link" href="#">{{ page_num }}</a></li>
												{% else %}
													<li class="page-item"><a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a></li>
												{% endif %}
											{% endfor %}
								
											{% if page_obj.has_next %}
											<li class="page-item page-next">
												<a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
											</li>
											{% else %}
											<li class="page-item page-next disabled">
												<a class="page-link" href="#">Next</a>
											</li>
											{% endif %}
										</ul>
									</div>
								</div>

								{% comment %} <div class="mb-5">
									<div class="float-end">
										<ul class="pagination ">
											<li class="page-item page-prev disabled">
												<a class="page-link" href="#" tabindex="-1">Prev</a>
											</li>
											<li class="page-item active"><a class="page-link" href="#">1</a></li>
											<li class="page-item"><a class="page-link" href="#">2</a></li>
											<li class="page-item"><a class="page-link" href="#">3</a></li>
											<li class="page-item"><a class="page-link" href="#">4</a></li>
											<li class="page-item"><a class="page-link" href="#">5</a></li>
											<li class="page-item page-next"> 
												<a class="page-link" href="#">Next</a>
											</li>
										</ul>
									</div>
								</div> {% endcomment %}
							</div><!-- COL-END -->
						</div>
						<!-- ROW-1 CLOSED -->

        {% endblock %}

		{% block modal %}

		<!-- modal -->
		<div class="modal fade" id="Vertically" tabindex="-1" aria-labelledby="VerticallyLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered" role="document">
				<div class="modal-content modal-content-demo">
					<div class="modal-header">
						<h6 class="modal-title" id="VerticallyLabel">Add file</h6>
						<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<!-- Formulaire d'upload d'image -->
						<form id="uploadForm" method="post" enctype="multipart/form-data">
							{% csrf_token %}
							<!-- Assurez-vous d'inclure la classe dropify pour obtenir le même style -->
							<div class="mb-2">
								<input type="file" name="image" class="dropify" data-height="200" />
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button class="btn ripple btn-primary" type="submit" form="uploadForm">Add</button>
						<button class="btn ripple btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
					</div>
				</div>
			</div>
		</div>
		<!-- End modal -->

		<!-- Modal pour afficher l'image résultante -->
		<div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="resultModalLabel">Résultat de l'analyse</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<img id="resultImage" src="" alt="Image résultante">
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
					</div>
				</div>
			</div>
		</div>
		<!-- End Modal pour afficher l'image résultante -->

        {% endblock %}

    {% block scripts %}

	<script>
		//For Upload Image 
		document.getElementById('uploadForm').addEventListener('submit', function(event) {
			event.preventDefault();
			const formData = new FormData(this);
		
			fetch('{% url "analyse" %}', {
				method: 'POST',
				body: formData,
			})
			.then(response => response.json())
			.then(data => {
				if (data.success) {
					// Afficher l'image résultante dans la modal
					document.getElementById('resultImage').src = data.image_url;
					$('#resultModal').modal('show');
				} else {
					alert('Une erreur est survenue lors du traitement de l\'image.');
				}
			})
			.catch(error => {
				console.error('Erreur:', error);
				alert('Une erreur est survenue.');
			});
		});
	</script>

	<script>
		//For Delete Image
		document.addEventListener('DOMContentLoaded', function() {
			const deleteIcons = document.querySelectorAll('.delete-item');
			
			deleteIcons.forEach(icon => {
				icon.addEventListener('click', function(event) {
					event.preventDefault();
					
					const itemId = this.getAttribute('data-id');
					
					fetch(`/delete-item/${itemId}/`, {
						method: 'DELETE',
						headers: {
							'Content-Type': 'application/json',
							'X-CSRFToken': '{{ csrf_token }}'  
						}
					})
					.then(response => response.json())
					.then(data => {
						if (data.success) {
							// Remove the item from the DOM
							const productCard = this.closest('.product-each');
							productCard.remove();
						} else {
							alert('Failed to delete the item.');
						}
					})
					.catch(error => console.error('Error:', error));
				});
			});
		});
	</script>
		
	<!-- INTERNAL SELECT2 JS -->
	<script src=" {% static 'assets/plugins/select2/select2.full.min.js' %} "></script>
	<script src=" {% static 'assets/js/select2.js' %} "></script>

	<!-- ANALYSE JS -->
	<script src=" {% static 'assets/js/analyse.js' %} "></script>
	
	<!--Internal Fileuploads js-->
	<script src=" {% static 'assets/plugins/fileuploads/js/fileupload.js' %} "></script>
	<script src=" {% static 'assets/plugins/fileuploads/js/file-upload.js' %} "></script>

	<!-- THEMECOLORS JS -->
	<script src="{% static 'assets/js/themeColors.js'%}"></script>

    {% endblock %}