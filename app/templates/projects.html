{% extends 'components/base.html' %}
{% load static %}

    {% block styles %}
	
		<style>
			.parcelle{
				background-color: #548e0ba1;
				font-weight: 500;
				padding: 10px 8px;
				border-radius: 6px;
				color: white;
				margin-right: 7px;
				margin-bottom: 7px;
			}
			.parcelle:hover{
				color: black;
				font-weight: 500;
			}
		</style>

    {% endblock %}
    
        {% block content %}
		<body onload="execute()">
			<!-- PAGE-HEADER -->
			<div class="page-header">
				<div>
					<h1 class="page-title">Projets</h1>
				</div>
				<div class="ms-auto pageheader-btn">
					<ol class="breadcrumb">
						{% comment %} <li class="breadcrumb-item">Apps</li> {% endcomment %}
						<li class="breadcrumb-item"><a href="javascript:void(0);">Tra√ßage Projets</a></li>
						<li class="breadcrumb-item active" aria-current="page">Projets</li>
					</ol>
				</div>
			</div>
			<!-- PAGE-HEADER END -->

			<!--ROW OPENED-->
			<div class="row">
				<div class="col-md-12">
					<div class="row">
						<div class="col-md-12">
							<div class="card">
								<div class="card-body project-type-container projects p-4">
									<h4 class="m-0" id="typeTitle">Tous Les Projets</h4>
									<input id="projects" value="{{ projects }}" style="display: none;" />
									<div class="d-sm-flex align-items-center">
										<div class="btn-list mx-4">
											<a class="btn btn-outline-primary" href="project-new">Ajouter Projet
												<svg fill="#					" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M21,18.3V5.7c0.6-0.3,1-1,1-1.7c0-1.1-0.9-2-2-2c-0.7,0-1.4,0.4-1.7,1H5.7C5.4,2.4,4.7,2,4,2C2.9,2,2,2.9,2,4c0,0.7,0.4,1.4,1,1.7v12.6c-0.6,0.3-1,1-1,1.7c0,1.1,0.9,2,2,2c0.7,0,1.4-0.4,1.7-1h12.6c0.3,0.6,1,1,1.7,1c1.1,0,2-0.9,2-2C22,19.3,21.6,18.6,21,18.3z M19,18.3c-0.3,0.2-0.5,0.4-0.7,0.7H5.7c-0.2-0.3-0.4-0.5-0.7-0.7V5.7C5.3,5.5,5.5,5.3,5.7,5h12.6c0.2,0.3,0.4,0.5,0.7,0.7V18.3z M14,9V8c0-0.6-0.4-1-1-1H8C7.4,7,7,7.4,7,8v5c0,0.6,0.4,1,1,1h1v-3c0-1.1,0.9-2,2-2H14z M16,10h-5c-0.6,0-1,0.4-1,1v5c0,0.6,0.4,1,1,1h5c0.6,0,1-0.4,1-1v-5C17,10.4,16.6,10,16,10z"></path></g></svg>
											</a>																								
											<a class="btn btn-primary" href="#">
												<svg xmlns="http://www.w3.org/2000/svg" class="w-inner-icn text-white" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="M21.5,13h-8.0005493C13.2234497,13.0001831,12.9998169,13.223999,13,13.5v8.0005493C13.0001831,21.7765503,13.223999,22.0001831,13.5,22h8.0006104C21.7765503,21.9998169,22.0001831,21.776001,22,21.5v-8.0006104C21.9998169,13.2234497,21.776001,12.9998169,21.5,13z M21,21h-7v-7h7V21z M10.5,2H2.4993896C2.2234497,2.0001831,1.9998169,2.223999,2,2.5v8.0005493C2.0001831,10.7765503,2.223999,11.0001831,2.5,11h8.0006104C10.7765503,10.9998169,11.0001831,10.776001,11,10.5V2.4993896C10.9998169,2.2234497,10.776001,1.9998169,10.5,2z M10,10H3V3h7V10z M10.5,13H2.4993896C2.2234497,13.0001831,1.9998169,13.223999,2,13.5v8.0005493C2.0001831,21.7765503,2.223999,22.0001831,2.5,22h8.0006104C10.7765503,21.9998169,11.0001831,21.776001,11,21.5v-8.0006104C10.9998169,13.2234497,10.776001,12.9998169,10.5,13z M10,21H3v-7h7V21z M21.5,2h-8.0005493C13.2234497,2.0001831,12.9998169,2.223999,13,2.5v8.0005493C13.0001831,10.7765503,13.223999,11.0001831,13.5,11h8.0006104C21.7765503,10.9998169,22.0001831,10.776001,22,10.5V2.4993896C21.9998169,2.2234497,21.776001,1.9998169,21.5,2z M21,10h-7V3h7V10z"/></svg>
											</a>
											{% comment %} <a class="btn btn-outline-primary" href="projects-list">
												<svg xmlns="http://www.w3.org/2000/svg" class="w-inner-icn" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="M3.5,12C3.223877,12,3,12.223877,3,12.5S3.223877,13,3.5,13S4,12.776123,4,12.5S3.776123,12,3.5,12z M6.5,8h15C21.776123,8,22,7.776123,22,7.5S21.776123,7,21.5,7h-15C6.223877,7,6,7.223877,6,7.5S6.223877,8,6.5,8z M3.5,17C3.223877,17,3,17.223877,3,17.5S3.223877,18,3.5,18S4,17.776123,4,17.5S3.776123,17,3.5,17z M21.5,12h-15C6.223877,12,6,12.223877,6,12.5S6.223877,13,6.5,13h15c0.276123,0,0.5-0.223877,0.5-0.5S21.776123,12,21.5,12z M3.5,7C3.223877,7,3,7.223877,3,7.5S3.223877,8,3.5,8S4,7.776123,4,7.5S3.776123,7,3.5,7z M21.5,17h-15C6.223877,17,6,17.223877,6,17.5S6.223877,18,6.5,18h15c0.276123,0,0.5-0.223877,0.5-0.5S21.776123,17,21.5,17z"/></svg>
											</a> {% endcomment %}
											
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row ">
						<div class="tab-content">
							<div class="tab-pane active h-100" id="allProjects">
								<div class="row">
									{% for project in projects %}
									<div class="col-sm-12 col-md-12 col-lg-16 col-xl-6">
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col-md-12">
														<div class="row">
															<div class="col">
																<div class="d-sm-flex align-items-center">
																	<div class="avatar mb-2 p-2 lh-1 mb-sm-0 avatar-md rounded-circle bg-primary me-2">
																		{% comment %} <svg xmlns="http://www.w3.org/2000/svg" class="w-icn text-white" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="M4.2069702,12l5.1464844-5.1464844c0.1871338-0.1937866,0.1871338-0.5009155,0-0.6947021C9.1616211,5.9602051,8.8450928,5.9547119,8.6464844,6.1465454l-5.5,5.5c-0.000061,0-0.0001221,0.000061-0.0001221,0.0001221c-0.1951904,0.1951904-0.1951294,0.5117188,0.0001221,0.7068481l5.5,5.5C8.7401123,17.9474487,8.8673706,18.0001831,9,18c0.1325684,0,0.2597046-0.0526733,0.3533936-0.1464233c0.1953125-0.1952515,0.1953125-0.5118408,0.0001221-0.7070923L4.2069702,12z M20.8534546,11.6465454l-5.5-5.5c-0.1937256-0.1871948-0.5009155-0.1871948-0.6947021,0c-0.1986084,0.1918335-0.2041016,0.5083618-0.0122681,0.7069702L19.7930298,12l-5.1465454,5.1464844c-0.09375,0.09375-0.1464233,0.2208862-0.1464233,0.3534546C14.5,17.776062,14.723877,17.999939,15,18c0.1326294,0.0001221,0.2598267-0.0525513,0.3534546-0.1464844l5.5-5.5c0.000061-0.000061,0.0001221-0.000061,0.0001831-0.0001221C21.0487671,12.1581421,21.0487061,11.8416748,20.8534546,11.6465454z"></path></svg> {% endcomment %}
																		<svg fill="#000000" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M21,18.3V5.7c0.6-0.3,1-1,1-1.7c0-1.1-0.9-2-2-2c-0.7,0-1.4,0.4-1.7,1H5.7C5.4,2.4,4.7,2,4,2C2.9,2,2,2.9,2,4c0,0.7,0.4,1.4,1,1.7v12.6c-0.6,0.3-1,1-1,1.7c0,1.1,0.9,2,2,2c0.7,0,1.4-0.4,1.7-1h12.6c0.3,0.6,1,1,1.7,1c1.1,0,2-0.9,2-2C22,19.3,21.6,18.6,21,18.3z M19,18.3c-0.3,0.2-0.5,0.4-0.7,0.7H5.7c-0.2-0.3-0.4-0.5-0.7-0.7V5.7C5.3,5.5,5.5,5.3,5.7,5h12.6c0.2,0.3,0.4,0.5,0.7,0.7V18.3z M14,9V8c0-0.6-0.4-1-1-1H8C7.4,7,7,7.4,7,8v5c0,0.6,0.4,1,1,1h1v-3c0-1.1,0.9-2,2-2H14z M16,10h-5c-0.6,0-1,0.4-1,1v5c0,0.6,0.4,1,1,1h5c0.6,0,1-0.4,1-1v-5C17,10.4,16.6,10,16,10z"></path></g></svg>
																	</div>
																	<div class="ms-1">
																		<h6 class="mb-1"> <a href="project-details/{{ project.project.geozone_id }}/" class="float-start">{{ project.project.project_name }}</a></h6>
																		<h5><span class="text-muted border-end pe-2 fs-11 float-start mt-1">{{ project.project.project_category }}</span></h5>
																		<h5><span class="text-teritary border-end pe-2 fs-11 float-start mt-1">{{ project.project.department }}</span></h5>
																	</div>
																</div>
															</div>
															<div class="col-auto">
																<div class="d-flex align-items-center">
																	{% comment %} <div class="stars-main me-3">
																		<i class="fa fa-star text-light star"></i>
																	</div> {% endcomment %}
																	
																	<a href="#" class="option-dots" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fe fe-more-vertical"></i></a>
																	<div class="dropdown-menu dropdown-menu-start">
																		<a class="dropdown-item" href="{% url 'project-modifier' project.project.id %}"><i class="fe fe-edit me-2"></i> Modifier </a>
																		{% comment %} <a class="dropdown-item" href="#"><i class="fe fe-share me-2"></i> Share</a>
																		<a class="dropdown-item" href="#"><i class="fe fe-download me-2"></i> Clone</a> {% endcomment %}																													
																		<a class="dropdown-item" href="#" onclick="return confirmDelete({{ project.project.id }})"><i class="fe fe-trash me-2"></i> Supprimer </a>
																		{% comment %} <a class="dropdown-item" href="#"><i class="fe fe-trash me-2"></i> Delete</a> {% endcomment %}
																	</div>
																	
																</div>
															</div>
														</div>
													</div>
													<div class="col-md-12 mt-4">
														<div class="btn-list mx-4">
															<a class="btn btn-outline-primary" href="parcelle-new/{{ project.project.geozone_id }}/">Ajouter Parcelle
																<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24">
																	<g id="SVGRepo_bgCarrier" stroke-width="0"></g>
																	<g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
																	<g id="SVGRepo_iconCarrier">
																		<path d="M400,168H328V112h32V16H264V48H112V16H16v96H48V264H16v96h96V328h72v72H152v96h96V464H400v32h96V400H464V232h32V136H400ZM296,48h32V80H296Zm32,248v32H296V296ZM48,48H80V80H48ZM80,328H48V296H80Zm32-32V264H80V112h32V80H264v32h32V264H264v32ZM216,464H184V432h32Zm248,0H432V432h32ZM432,168h32v32H432Zm0,232H400v32H248V400H216V328h48v32h96V264H328V200h72v32h32Z" 
																			  stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
																	</g>
																</svg>
															</a>
															<a class="btn btn-outline-primary" href="ajouter-equipement">Ajouter Equipement
																<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" fill="#000000" width="24" height="24">
																	<g id="SVGRepo_bgCarrier" stroke-width="0"></g>
																	<g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
																	<g id="SVGRepo_iconCarrier">
																		<path  d="M115.326 16.008l-6.607 6.687-84.652 85.69 5.59 6.53c10.402 12.15 29.93 23.87 51.26 30.993 10.664 3.562 21.715 5.826 32.377 5.492 5.407-.17 10.82-1.064 15.87-2.927 80.876 79.96 159.667 163.084 238.45 246.224-15.764 14.68-32.013 27.47-47.04 36.48 56.644 56.644 126.465 79.034 164.038 55.13 23.05-37.774 1.1-107.81-55.13-164.04-9.788 15.074-22.24 30.962-35.962 46.126L151.966 126.838c6.244-12.63 7.403-27.838 4.406-43.037-4.142-21.013-15.986-42.734-34.397-61.146l-6.647-6.646zm345.05.63c-32.676 47.53-70.88 89.537-116.368 124.258l-37.158-37.158c6.3-16.228 3.107-35.234-9.99-48.332-4.288-4.287-9.257-7.455-14.52-9.68 6.68 16.484 3.194 36.496-10.166 49.856s-32.888 16.36-49.373 9.68c2.225 5.262 5.397 10.234 9.682 14.52h.002c13.455 13.456 32.87 16.743 49.243 9.872l21.287 21.287c-15.632 18.116-31.658 35.568-48.014 52.503l20.088 20.088 48.916-48.915 13.215 13.215-48.917 48.916 18.748 18.748c16.877-16.2 34.298-32.163 52.495-48.02l21.9 21.9c-5.98 16.088-2.7 34.778 10.23 47.708 4.288 4.287 9.26 7.456 14.522 9.68-6.68-16.484-3.194-36.495 10.166-49.856 13.36-13.36 32.888-16.36 49.373-9.68-2.224-5.262-5.396-10.234-9.68-14.52h-.003c-13.62-13.62-33.345-16.814-49.842-9.606l-37.394-37.395c33.954-46.255 77.08-83.34 124.932-115.695l-33.37-33.373zM126.557 58.66c5.788 9.68 9.664 19.54 11.48 28.756 3.294 16.703.142 30.55-8.735 39.428-3.674 3.674-9.08 5.642-16.59 5.877-7.508.236-16.702-1.474-25.872-4.536-7.113-2.376-14.22-5.65-20.625-9.182l60.344-60.342zm79.075 193.522c-51.082 48.22-104.743 92.797-159.567 137.162L17.877 491.98l104.275-27.615c45.657-58.363 88.954-110.13 135.037-158.697-6.167-6.44-12.337-12.876-18.512-19.297L70.445 454.605 57.23 441.39 225.707 272.91c-6.684-6.924-13.376-13.835-20.076-20.73z"
																				stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
																	</g>
																</svg>
															</a>
														</div>
													</div>
													<div class="col-md-12 mt-4">
														<div class="row align-items-center">
															<div class="col">
																<p class="m-0 mb-2">{{ project.project.client }}</p>
																<div class="avatar-list avatar-list-stacked">
																	{% comment %} <span class="avatar bradius cover-image" data-bs-image-src= "{% static 'assets/images/users/9.jpg' %}"></span>
																	<span class="avatar bradius cover-image" data-bs-image-src= "{% static 'assets/images/users/8.jpg' %}"></span>
																	<span class="avatar bradius cover-image" data-bs-image-src= "{% static 'assets/images/users/11.jpg' %}"></span>
																	<span class="avatar bradius cover-image" data-bs-image-src= "{% static 'assets/images/users/1.jpg' %}"></span>
																	<span class="avatar bradius cover-image" data-bs-image-src= "{% static 'assets/images/users/6.jpg' %}"></span>
																	<span class="avatar bradius bg-primary">+15</span> {% endcomment %}
																</div>
															</div>
															<div class="col-auto">
																<p class="mb-0">
																	<span class="text-muted d-block">Date</span>
																	<span class="text-danger">{{ project.project.project_date }}</span>
																</p>
															</div>
															<div class="raw">
															<div class="col-md-12 mt-4">
																{% for parcelle in project.parcelles %}
																	<button class="parcelle" onclick="window.location.href='parcelle-details/{{ parcelle.geozone_id }}/'">
																		{{ parcelle.parcelle_name }}
																	</buttton>
																{% endfor %}
															</div> 	
															</div> 
														</div>
													</div>
													{% comment %} <div class="col-md-12 mt-4">
														<div class="text-center d-f-ai-c-jc-c">
															<div class="wp-100">
																<div class="project-percentage small-bar small-lg">
																	<div class="percentage-title">
																		<span>Progress</span>
																		<span class="progress-main font-weight-semibold text-13 mb-1">45%</span>
																	</div>
																	<div class="progress fileprogress mb-2 h-auto">
																		<div class="progress-bar" role="progressbar"></div>
																	</div>
																</div>
															</div>
														</div>
													</div> {% endcomment %}
												</div>
											</div>
										</div>
									</div>
									{% endfor %}
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>
			<!--ROW CLOSED-->
			<script>
				function execute(){
					let projects = document.getElementById('projects').value;
					console.log(projects);
				}
			</script>
		</body>

        {% endblock %}

    {% block scripts %}

	<script>
		function confirmDelete(projectId) {
			// Utilisation de SweetAlert pour la confirmation
			Swal.fire({
				title: '√ätes-vous s√ªr ?',
				text: "Voulez-vous vraiment supprimer ce projet ? Cette action est irr√©versible.",
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Oui, supprimer',
				cancelButtonText: 'Annuler'
			}).then((result) => {
				if (result.isConfirmed) {
					// Si l'utilisateur confirme la suppression
					fetch("{% url 'delete_project' project_id=0 %}".replace(/0/, projectId), {
						method: 'POST',
						headers: {
							'X-CSRFToken': '{{ csrf_token }}'
						}
					}).then(response => {
						if (response.ok) {
							// Afficher un message de succ√®s avec SweetAlert
							Swal.fire({
								icon: 'success',
								title: 'Supprim√© !',
								text: 'Le projet a √©t√© supprim√© avec succ√®s.',
								timer: 1500,
								showConfirmButton: false
							}).then(() => {
								// Rediriger ou rafra√Æchir la page apr√®s la suppression
								window.location.href = "/projects";
							});
						} else {
							// Afficher un message d'erreur en cas de probl√®me
							Swal.fire({
								icon: 'error',
								title: 'Erreur',
								text: 'Une erreur s\'est produite lors de la suppression du projet.'
							});
						}
					}).catch(error => {
						Swal.fire({
							icon: 'error',
							title: 'Erreur r√©seau',
							text: 'Une erreur r√©seau s\'est produite: ' + error
						});
					});
				}
			});
			return false; // Pour √©viter la navigation imm√©diate
		}
	</script>
	
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<!-- PROJECT JS-->
		<script src=" {% static 'assets/js/projects.js' %} "></script>

        <!-- THEMECOLORS JS -->
        <script src="{% static 'assets/js/themeColors.js'%}"></script>

    {% endblock %}